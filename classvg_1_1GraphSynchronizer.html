<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>vg: vg::GraphSynchronizer Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">vg
   </div>
   <div id="projectbrief">tools for working with variation graphs</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacevg.html">vg</a></li><li class="navelem"><a class="el" href="classvg_1_1GraphSynchronizer.html">GraphSynchronizer</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="classvg_1_1GraphSynchronizer-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">vg::GraphSynchronizer Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;graph_synchronizer.hpp&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvg_1_1GraphSynchronizer_1_1Lock.html">Lock</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:addf1e96558546d4f5e708827b9eb4d67"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvg_1_1GraphSynchronizer.html#addf1e96558546d4f5e708827b9eb4d67">GraphSynchronizer</a> (<a class="el" href="classvg_1_1VG.html">VG</a> &amp;<a class="el" href="classvg_1_1GraphSynchronizer.html#ab0856b30a01193d100f9e470ea61a67c">graph</a>)</td></tr>
<tr class="separator:addf1e96558546d4f5e708827b9eb4d67"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac33a770c7ce8206e4649133062333898"><td class="memItemLeft" align="right" valign="top">const string &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvg_1_1GraphSynchronizer.html#ac33a770c7ce8206e4649133062333898">get_path_sequence</a> (const string &amp;path_name)</td></tr>
<tr class="separator:ac33a770c7ce8206e4649133062333898"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a336f5828883adce86ee5e536f8c299ea"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvg_1_1GraphSynchronizer.html#a336f5828883adce86ee5e536f8c299ea">with_path_index</a> (const string &amp;path_name, const function&lt; void(const <a class="el" href="structvg_1_1PathIndex.html">PathIndex</a> &amp;)&gt; &amp;to_run)</td></tr>
<tr class="separator:a336f5828883adce86ee5e536f8c299ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:aa13b46c21814ff09172452e28a4da71d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structvg_1_1PathIndex.html">PathIndex</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvg_1_1GraphSynchronizer.html#aa13b46c21814ff09172452e28a4da71d">get_path_index</a> (const string &amp;path_name)</td></tr>
<tr class="separator:aa13b46c21814ff09172452e28a4da71d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a056cd54145b467de24d6ce128749af27"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvg_1_1GraphSynchronizer.html#a056cd54145b467de24d6ce128749af27">update_path_indexes</a> (const vector&lt; <a class="el" href="structvg_1_1Translation.html">Translation</a> &gt; &amp;translations)</td></tr>
<tr class="separator:a056cd54145b467de24d6ce128749af27"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:ab0856b30a01193d100f9e470ea61a67c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classvg_1_1VG.html">VG</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvg_1_1GraphSynchronizer.html#ab0856b30a01193d100f9e470ea61a67c">graph</a></td></tr>
<tr class="memdesc:ab0856b30a01193d100f9e470ea61a67c"><td class="mdescLeft">&#160;</td><td class="mdescRight">The graph we manage.  <a href="classvg_1_1GraphSynchronizer.html#ab0856b30a01193d100f9e470ea61a67c">More...</a><br /></td></tr>
<tr class="separator:ab0856b30a01193d100f9e470ea61a67c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1a7be56b29656fa604b44b37e134c80"><td class="memItemLeft" align="right" valign="top">mutex&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvg_1_1GraphSynchronizer.html#aa1a7be56b29656fa604b44b37e134c80">whole_graph_lock</a></td></tr>
<tr class="separator:aa1a7be56b29656fa604b44b37e134c80"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7f9e68c4e2172bc4a5c7040272a59d38"><td class="memItemLeft" align="right" valign="top">condition_variable&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvg_1_1GraphSynchronizer.html#a7f9e68c4e2172bc4a5c7040272a59d38">wait_for_region</a></td></tr>
<tr class="separator:a7f9e68c4e2172bc4a5c7040272a59d38"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1127fed39b1d4775bf03ada4f87b23b4"><td class="memItemLeft" align="right" valign="top">map&lt; string, <a class="el" href="structvg_1_1PathIndex.html">PathIndex</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvg_1_1GraphSynchronizer.html#a1127fed39b1d4775bf03ada4f87b23b4">indexes</a></td></tr>
<tr class="separator:a1127fed39b1d4775bf03ada4f87b23b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a275e3112ec47229a197e3ecc118771c4"><td class="memItemLeft" align="right" valign="top">set&lt; <a class="el" href="namespacevg.html#afaa15fd8bdfd688d48561e1b12aee821">id_t</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvg_1_1GraphSynchronizer.html#a275e3112ec47229a197e3ecc118771c4">locked_nodes</a></td></tr>
<tr class="memdesc:a275e3112ec47229a197e3ecc118771c4"><td class="mdescLeft">&#160;</td><td class="mdescRight">This holds all the node IDs that are currently locked by someone.  <a href="classvg_1_1GraphSynchronizer.html#a275e3112ec47229a197e3ecc118771c4">More...</a><br /></td></tr>
<tr class="separator:a275e3112ec47229a197e3ecc118771c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Let threads get exclusive locks on subgraphs of a vg graph, for reading and editing. Whan a subgraph is locked, a copy is accessible through the lock object and the underlying graph can be edited (through the lock) without affecting any other locked subgraphs.</p>
<p>A thread may only hold a lock on a single subgraph at a time. Trying to lock another subgraph while you already have a subgraph locked is likely to result in a deadlock. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="addf1e96558546d4f5e708827b9eb4d67"></a>
<h2 class="memtitle"><span class="permalink"><a href="#addf1e96558546d4f5e708827b9eb4d67">&#9670;&nbsp;</a></span>GraphSynchronizer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">vg::GraphSynchronizer::GraphSynchronizer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classvg_1_1VG.html">VG</a> &amp;&#160;</td>
          <td class="paramname"><em>graph</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create a <a class="el" href="classvg_1_1GraphSynchronizer.html">GraphSynchronizer</a> for synchronizing on parts of the given graph. </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="aa13b46c21814ff09172452e28a4da71d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa13b46c21814ff09172452e28a4da71d">&#9670;&nbsp;</a></span>get_path_index()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structvg_1_1PathIndex.html">PathIndex</a> &amp; vg::GraphSynchronizer::get_path_index </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>path_name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the index for the given path name. <a class="el" href="classvg_1_1GraphSynchronizer_1_1Lock.html">Lock</a> on the indexes and graph must be held already. </p>

</div>
</div>
<a id="ac33a770c7ce8206e4649133062333898"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac33a770c7ce8206e4649133062333898">&#9670;&nbsp;</a></span>get_path_sequence()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const string &amp; vg::GraphSynchronizer::get_path_sequence </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>path_name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Since internally we keep PathIndexes for paths in the graph, we expose this method for getting the strings for paths. </p>

</div>
</div>
<a id="a056cd54145b467de24d6ce128749af27"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a056cd54145b467de24d6ce128749af27">&#9670;&nbsp;</a></span>update_path_indexes()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void vg::GraphSynchronizer::update_path_indexes </td>
          <td>(</td>
          <td class="paramtype">const vector&lt; <a class="el" href="structvg_1_1Translation.html">Translation</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>translations</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Update all the path indexes according to the given translations. <a class="el" href="classvg_1_1GraphSynchronizer_1_1Lock.html">Lock</a> on the indexes and graph must be held already. </p>

</div>
</div>
<a id="a336f5828883adce86ee5e536f8c299ea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a336f5828883adce86ee5e536f8c299ea">&#9670;&nbsp;</a></span>with_path_index()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vg::GraphSynchronizer::with_path_index </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>path_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const function&lt; void(const <a class="el" href="structvg_1_1PathIndex.html">PathIndex</a> &amp;)&gt; &amp;&#160;</td>
          <td class="paramname"><em>to_run</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>We can actually let users run whatever function they want with an exclusive handle on a <a class="el" href="structvg_1_1PathIndex.html">PathIndex</a>, with the guarantee that the graph won't change while they're working. </p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="ab0856b30a01193d100f9e470ea61a67c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab0856b30a01193d100f9e470ea61a67c">&#9670;&nbsp;</a></span>graph</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classvg_1_1VG.html">VG</a>&amp; vg::GraphSynchronizer::graph</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The graph we manage. </p>

</div>
</div>
<a id="a1127fed39b1d4775bf03ada4f87b23b4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1127fed39b1d4775bf03ada4f87b23b4">&#9670;&nbsp;</a></span>indexes</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">map&lt;string, <a class="el" href="structvg_1_1PathIndex.html">PathIndex</a>&gt; vg::GraphSynchronizer::indexes</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>We need indexes of all the paths that someone might want to use as a basis for locking. This holds a <a class="el" href="structvg_1_1PathIndex.html">PathIndex</a> for each path we touch by path name. </p>

</div>
</div>
<a id="a275e3112ec47229a197e3ecc118771c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a275e3112ec47229a197e3ecc118771c4">&#9670;&nbsp;</a></span>locked_nodes</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">set&lt;<a class="el" href="namespacevg.html#afaa15fd8bdfd688d48561e1b12aee821">id_t</a>&gt; vg::GraphSynchronizer::locked_nodes</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This holds all the node IDs that are currently locked by someone. </p>

</div>
</div>
<a id="a7f9e68c4e2172bc4a5c7040272a59d38"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7f9e68c4e2172bc4a5c7040272a59d38">&#9670;&nbsp;</a></span>wait_for_region</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">condition_variable vg::GraphSynchronizer::wait_for_region</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>We have one condition variable where we have blocked all the threads that are waiting to lock subgraphs but couldn't the first time because we ran into already locked nodes. When nodes get unlocked, we wake them all up, and they each grab the mutex and check, one at a time, to see if they can have all their nodes this time. </p>

</div>
</div>
<a id="aa1a7be56b29656fa604b44b37e134c80"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa1a7be56b29656fa604b44b37e134c80">&#9670;&nbsp;</a></span>whole_graph_lock</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">mutex vg::GraphSynchronizer::whole_graph_lock</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>We use this to lock the whole graph, for when we're exploring and trying to lock a context, or for when we're making an edit, or for when we're trying to lock a context, or for when we're working with the PathIndexes. It's only ever held during functions in this class or internal classes (monitor-style), so we don't need it to be a recursive mutex. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>src/<a class="el" href="graph__synchronizer_8hpp.html">graph_synchronizer.hpp</a></li>
<li>src/<a class="el" href="graph__synchronizer_8cpp.html">graph_synchronizer.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
